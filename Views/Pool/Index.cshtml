
@model List<WebApplication1.Models.Computer>
@{
    ViewData["Title"] = "Havuz Envanteri";
    var successMessage = TempData["Success"] as string;
    var errorMessage = TempData["Error"] as string;
    var searchValue = ViewBag.Search as string;
    var companyIdValue = ViewBag.CompanyId as string;
    var categoryValue = ViewBag.Category as string;
    var itemModels = ViewBag.ItemModels as List<WebApplication1.Models.ItemModel> ?? new List<WebApplication1.Models.ItemModel>();
    var totalPoolItems = Model.Count + itemModels.Count;
    var availableComputers = Model.Count(c => c.Status == ComputerStatus.Havuzda);
    var availableItemModels = itemModels.Count(i => i.AssignmentStatus == "Unassigned" || i.AssignmentStatus == null);
    var maintenanceComputers = Model.Count(c => c.Status == ComputerStatus.Bakim);
    var brokenComputers = Model.Count(c => c.Status == ComputerStatus.Bozuk || c.Status == ComputerStatus.Arızalı);
    var thisMonthItems = Model.Count(c => c.CreatedDate.Month == DateTime.Now.Month && c.CreatedDate.Year == DateTime.Now.Year) + 
                        itemModels.Count(i => i.CreatedDate.Month == DateTime.Now.Month && i.CreatedDate.Year == DateTime.Now.Year);
}

<!-- Success/Error Messages -->
@if (!string.IsNullOrEmpty(successMessage))
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            Swal.fire({
                icon: 'success',
                title: 'Başarılı!',
                text: '@successMessage',
                timer: 3000,
                showConfirmButton: false,
                toast: true,
                position: 'top-end'
            });
        });
    </script>
}

@if (!string.IsNullOrEmpty(errorMessage))
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            Swal.fire({
                icon: 'error',
                title: 'Hata!',
                text: '@errorMessage',
                timer: 3000,
                showConfirmButton: false,
                toast: true,
                position: 'top-end'
            });
        });
    </script>
}

<div class="container-fluid mt-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div>
                    <h1 class="h2 mb-1 d-flex align-items-center">
                        <i class="fas fa-warehouse text-info me-2" aria-hidden="true"></i>
                        Havuz Envanteri
                    </h1>
                    <p class="text-muted mb-0">Havuzda bulunan malzemeleri yönetin</p>
                </div>
               <div class="d-flex gap-2 flex-wrap">
<div class="d-flex gap-2 flex-wrap">
    <div class="dropdown">
        <button class="btn btn-primary rounded-3 px-4 py-2 d-flex align-items-center gap-2 shadow-sm"
                type="button" id="addDropdownButton" data-bs-toggle="dropdown" aria-expanded="false"
                style="font-size: 1rem; font-weight: 600;">
            <i class="fas fa-plus"></i>
            Yeni Ürün Ekle
            <i class="fas fa-caret-down ms-2"></i>
        </button>
        <ul class="dropdown-menu shadow-lg rounded-3 p-2 mt-2" aria-labelledby="addDropdownButton" style="min-width: 210px;">
            <li>
                <a class="dropdown-item d-flex align-items-center gap-2 py-2" asp-controller="Computers" asp-action="Create" style="font-size: 1rem;">
                    <i class="fas fa-desktop text-primary"></i> Bilgisayar Ekle
                </a>
            </li>
            <li>
                <a class="dropdown-item d-flex align-items-center gap-2 py-2" asp-controller="Items" asp-action="Create" style="font-size: 1rem;">
                    <i class="fas fa-box-open text-success"></i> Sarf Malzeme Ekle
                </a>
            </li>
            <li>
                <a class="dropdown-item d-flex align-items-center gap-2 py-2" asp-controller="Software" asp-action="Create" style="font-size: 1rem;">
                    <i class="fas fa-mouse text-warning"></i> Yazılım Ekle
                </a>
            </li>
        </ul>
    </div>
    <button type="button" class="btn btn-outline-success rounded-3 px-4 py-2 d-flex align-items-center gap-2 shadow-sm"
            style="font-size: 1rem; font-weight: 600;"
            onclick="assignSelectedItems()">
        <i class="fas fa-user-plus"></i>
        Seçilenleri Zimmetle
    </button>
</div>


            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info text-white h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">Toplam Havuz</h5>
                            <h3 class="mb-0 fw-bold">@totalPoolItems</h3>
                            <small>@Model.Count Bilgisayar + @itemModels.Count Ürün</small>
                        </div>
                        <div>
                            <i class="fas fa-box archive fa-2x opacity-75" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success text-white h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">Kullanıma Hazır</h5>
                            <h3 class="mb-0 fw-bold">@(availableComputers + availableItemModels)</h3>
                            <small>@availableComputers Bilgisayar + @availableItemModels Ürün</small>
                        </div>
                        <div>
                            <i class="fas fa-check-circle fa-2x opacity-75" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning text-white h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">Bakımda</h5>
                            <h3 class="mb-0 fw-bold">@maintenanceComputers</h3>
                        </div>
                        <div>
                            <i class="fas fa-tools fa-2x opacity-75" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-danger text-white h-100 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">Arızalı/Bozuk</h5>
                            <h3 class="mb-0 fw-bold">@brokenComputers</h3>
                        </div>
                        <div>
                            <i class="fas fa-exclamation-triangle fa-2x opacity-75" aria-hidden="true"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="card mb-4 shadow-sm">
        <div class="card-header bg-light">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="h6 mb-0 d-flex align-items-center">
                    <i class="fas fa-search me-2" aria-hidden="true"></i> Arama ve Filtreleme
                </h2>
                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse"
                        data-bs-target="#searchFilters" aria-expanded="true" aria-controls="searchFilters">
                    <i class="fas fa-filter me-1" aria-hidden="true"></i> Filtreler
                </button>
            </div>
        </div>
        <div class="collapse show" id="searchFilters">
            <div class="card-body">
                <form method="get" asp-action="Index" id="searchForm" role="search">
                    <div class="row g-3 align-items-end">
                        <div class="col-lg-3 col-md-6">
                            <label for="search" class="form-label">
                                <i class="fas fa-desktop text-muted me-1" aria-hidden="true"></i>
                                Ürün Adı veya Barkod
                            </label>
                            <input type="text" name="search" id="search" value="@searchValue" class="form-control"
                                   placeholder="Ürün ara..." aria-describedby="searchHelp">
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <label for="category" class="form-label">
                                <i class="fas fa-tags text-muted me-1" aria-hidden="true"></i> Kategori
                            </label>
                            <select name="category" id="category" class="form-select">
                                <option value="">Tüm Kategoriler</option>
                                <option value="Computer" selected="@(categoryValue == "Computer")">Bilgisayar</option>
                                <!-- ItemModel kategorileri dinamik olarak yüklenebilir -->
                                @foreach (var category in itemModels.Where(i => !string.IsNullOrEmpty(i.Category)).Select(i => i.Category).Distinct())
                                {
                                    <option value="@category" selected="@(categoryValue == category)">@category</option>
                                }
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <label for="companyId" class="form-label">
                                <i class="fas fa-building text-muted me-1" aria-hidden="true"></i> Firma
                            </label>
                            <select name="companyId" id="companyId" class="form-select">
                                <option value="">Tüm Firmalar</option>
                                @if (ViewBag.Companies != null)
                                {
                                    @foreach (var company in ViewBag.Companies)
                                    {
                                        <option value="@company.Id" selected="@(companyIdValue == company.Id.ToString())">@company.Name</option>
                                    }
                                }
                            </select>
                        </div>
                        <div class="col-lg-2 col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="showOnlyAvailable" name="showOnlyAvailable" value="true">
                                <label class="form-check-label" for="showOnlyAvailable">
                                    <i class="fas fa-check text-success me-1" aria-hidden="true"></i>
                                    Sadece Kullanıma Hazır
                                </label>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="d-flex gap-2">
                                <button type="submit" class="btn btn-primary flex-fill" aria-label="Arama yap">
                                    <i class="fas fa-search me-1" aria-hidden="true"></i> Ara
                                </button>
                                <a href="@Url.Action("Index")" class="btn btn-outline-secondary flex-fill"
                                   aria-label="Filtreleri temizle">
                                    <i class="fas fa-times me-1" aria-hidden="true"></i> Temizle
                                </a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Pool Items Table -->
    <div class="card shadow-sm">
        <div class="card-header bg-white">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div class="d-flex align-items-center gap-3">
                    <h2 class="h6 mb-0 d-flex align-items-center">
                        <i class="fas fa-table me-2" aria-hidden="true"></i> Havuz Envanteri
                        <span class="badge bg-info ms-2">@totalPoolItems kayıt</span>
                    </h2>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                        <label class="form-check-label" for="selectAll">
                            Tümünü Seç
                        </label>
                    </div>
                </div>
                <div class="btn-group btn-group-sm" role="group" aria-label="Görünüm seçenekleri">
                    <input type="radio" class="btn-check" name="viewType" id="tableViewRadio" autocomplete="off" checked>
                    <label class="btn btn-outline-secondary" for="tableViewRadio" onclick="toggleView('table')">
                        <i class="fas fa-table me-1" aria-hidden="true"></i> Tablo
                    </label>
                    <input type="radio" class="btn-check" name="viewType" id="cardsViewRadio" autocomplete="off">
                    <label class="btn btn-outline-secondary" for="cardsViewRadio" onclick="toggleView('cards')">
                        <i class="fas fa-th-large me-1" aria-hidden="true"></i> Kartlar
                    </label>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            @if (Model.Any() || itemModels.Any())
            {
                <!-- Table View -->
                <div id="tableView" class="table-responsive">
                    <table class="table table-hover table-striped mb-0" role="table">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" style="width: 50px;">
                                    <i class="fas fa-check-square text-muted" aria-hidden="true"></i>
                                </th>
                                <th scope="col">
                                    <i class="fas fa-desktop me-1" aria-hidden="true"></i> Ürün Bilgileri
                                </th>
                                <th scope="col">
                                    <i class="fas fa-tags me-1" aria-hidden="true"></i> Kategori
                                </th>
                                <th scope="col">
                                    <i class="fas fa-building me-1" aria-hidden="true"></i> Durum/Zimmet
                                </th>
                                <th scope="col">
                                    <i class="fas fa-circle me-1" aria-hidden="true"></i> Tür
                                </th>
                                <th scope="col">
                                    <i class="fas fa-calendar me-1" aria-hidden="true"></i> Oluşturma Tarihi
                                </th>
                                <th scope="col" style="width: 200px;">
                                    <i class="fas fa-cogs me-1" aria-hidden="true"></i> İşlemler
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Computer kayıtları -->
                            @foreach (var computer in Model)
                            {
                                <tr class="@(computer.Status == ComputerStatus.Havuzda ? "table-success-light" : "")">
                                    <td>
                                        @if (computer.Status == ComputerStatus.Havuzda)
                                        {
                                            <input type="checkbox" class="form-check-input item-checkbox" value="computer_@computer.Id"
                                                   name="selectedItems" id="item_@computer.Id">
                                        }
                                        else
                                        {
                                            <i class="fas fa-minus text-muted" aria-hidden="true"></i>
                                        }
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="equipment-icon me-3" aria-hidden="true">
                                                <i class="fas fa-desktop fa-2x text-primary"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-1 fw-bold">@computer.Name</h6>
                                                @if (!string.IsNullOrEmpty(computer.AssetTag))
                                                {
                                                    <div class="small text-muted">
                                                        <i class="fas fa-tag me-1" aria-hidden="true"></i>
                                                        @computer.AssetTag
                                                    </div>
                                                }
                                                @if (!string.IsNullOrEmpty(computer.SerialNumber))
                                                {
                                                    <div class="small text-muted">
                                                        <i class="fas fa-barcode me-1" aria-hidden="true"></i>
                                                        @computer.SerialNumber
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-primary">
                                            <i class="fas fa-desktop me-1" aria-hidden="true"></i>
                                            Bilgisayar
                                        </span>
                                    </td>
                                    <td>
                                        @if (computer.Company != null)
                                        {
                                            <span class="badge bg-info">@computer.Company.Name</span>
                                        }
                                        else if (computer.AssignedEmployee != null)
                                        {
                                            <span class="badge bg-warning">@computer.AssignedEmployee.FirstName</span>
                                        }
                                        else
                                        {
                                            <em class="text-muted">Atanmamış</em>
                                        }
                                    </td>
                                    <td>
                                        @if (computer.Status == ComputerStatus.Havuzda)
                                        {
                                            <span class="badge bg-success">
                                                <i class="fas fa-desktop" aria-hidden="true"></i> Havuzda
                                            </span>
                                        }
                                        else if (computer.Status == ComputerStatus.Bakim)
                                        {
                                            <span class="badge bg-warning">
                                                <i class="fas fa-tools me-1" aria-hidden="true"></i> Bakımda
                                            </span>
                                        }
                                        else if (computer.Status == ComputerStatus.Arızalı || computer.Status == ComputerStatus.Bozuk)
                                        {
                                            <span class="badge bg-danger">
                                                <i class="fas fa-exclamation-triangle me-1" aria-hidden="true"></i>
                                                @(computer.Status == ComputerStatus.Arızalı ? "Arızalı" : "Bozuk")
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">
                                                <i class="fas fa-pause me-1" aria-hidden="true"></i> @computer.Status
                                            </span>
                                        }
                                    </td>
                                    <td>
                                        <time datetime="@computer.CreatedDate.ToString("yyyy-MM-dd")" class="small text-muted">
                                            @computer.CreatedDate.ToString("dd.MM.yyyy")
                                        </time>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group" aria-label="Ekipman işlemleri">
                                            @if (computer.Status == ComputerStatus.Havuzda)
                                            {
                                                <button type="button" class="btn btn-sm btn-outline-success"
                                                        onclick="assignToEmployee('computer', @computer.Id, '@computer.Name')"
                                                        title="Çalışana zimmetle" data-bs-toggle="tooltip">
                                                    <i class="fas fa-user-plus" aria-hidden="true"></i>
                                                </button>
                                            }
                                            <a asp-controller="Computers" asp-action="Details" asp-route-id="@computer.Id"
                                               class="btn btn-sm btn-outline-info"
                                               title="@computer.Name detaylarını görüntüle" data-bs-toggle="tooltip">
                                                <i class="fas fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a asp-controller="Computers" asp-action="Edit" asp-route-id="@computer.Id"
                                               class="btn btn-sm btn-outline-warning" title="@computer.Name bilgilerini düzenle"
                                               data-bs-toggle="tooltip">
                                                <i class="fas fa-edit" aria-hidden="true"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }

                            <!-- ItemModel kayıtları -->
                            @foreach (var item in itemModels)
                            {
                                <tr class="@(item.AssignmentStatus == "Unassigned" || item.AssignmentStatus == null ? "table-info-light" : "")">
                                    <td>
                                        @if (item.AssignmentStatus == "Unassigned" || item.AssignmentStatus == null)
                                        {
                                            <input type="checkbox" class="form-check-input item-checkbox" value="item_@item.Id"
                                                   name="selectedItems" id="item_model_@item.Id">
                                        }
                                        else
                                        {
                                            <i class="fas fa-minus text-muted" aria-hidden="true"></i>
                                        }
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="equipment-icon me-3" aria-hidden="true">
                                                @{
                                                    var iconClass = "fas fa-box";
                                                    if (!string.IsNullOrEmpty(item.Category))
                                                    {
                                                        iconClass = item.Category.ToLower() switch
                                                        {
                                                            "monitor" => "fas fa-tv",
                                                            "keyboard" => "fas fa-keyboard",
                                                            "mouse" => "fas fa-computer-mouse",
                                                            "printer" => "fas fa-print",
                                                            "phone" => "fas fa-phone",
                                                            _ => "fas fa-box"
                                                        };
                                                    }
                                                }
                                                <i class="@iconClass fa-2x text-success"></i>
                                            </div>
                                            <div>
                                                <h6 class="mb-1 fw-bold">@item.Name</h6>
                                                @if (!string.IsNullOrEmpty(item.SystemBarcode))
                                                {
                                                    <div class="small text-muted">
                                                        <i class="fas fa-barcode me-1" aria-hidden="true"></i>
                                                        @item.SystemBarcode
                                                    </div>
                                                }
                                                @if (!string.IsNullOrEmpty(item.Supplier))
                                                {
                                                    <div class="small text-muted">
                                                        <i class="fas fa-truck me-1" aria-hidden="true"></i>
                                                        @item.Supplier
                                                    </div>
                                                }
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-success">
                                            <i class="fas fa-tag me-1" aria-hidden="true"></i>
                                            @(string.IsNullOrEmpty(item.Category) ? "Diğer" : item.Category)
                                        </span>
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(item.AssignedPersonnel))
                                        {
                                            <span class="badge bg-warning">@item.AssignedPersonnel</span>
                                        }
                                        else
                                        {
                                            <em class="text-muted">Zimmetli değil</em>
                                        }
                                    </td>
                                    <td>
                                        @if (item.AssignmentStatus == "Unassigned" || item.AssignmentStatus == null)
                                        {
                                            <span class="badge bg-success">
                                                <i class="fas fa-check me-1" aria-hidden="true"></i> Kullanılabilir
                                            </span>
                                        }
                                        else if (item.AssignmentStatus == "Assigned")
                                        {
                                            <span class="badge bg-warning">
                                                <i class="fas fa-user me-1" aria-hidden="true"></i> Zimmetli
                                            </span>
                                        }
                                        else if (item.AssignmentStatus == "Under Maintenance")
                                        {
                                            <span class="badge bg-danger">
                                                <i class="fas fa-tools me-1" aria-hidden="true"></i> Bakımda
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">@item.AssignmentStatus</span>
                                        }
                                    </td>
                                    <td>
                                        <time datetime="@item.CreatedDate.ToString("yyyy-MM-dd")" class="small text-muted">
                                            @item.CreatedDate.ToString("dd.MM.yyyy")
                                        </time>
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group" aria-label="Ürün işlemleri">
                                            @if (item.AssignmentStatus == "Unassigned" || item.AssignmentStatus == null)
                                            {
                                                <button type="button" class="btn btn-sm btn-outline-success"
                                                        onclick="assignToEmployee('item', @item.Id, '@item.Name')"
                                                        title="Çalışana zimmetle" data-bs-toggle="tooltip">
                                                    <i class="fas fa-user-plus" aria-hidden="true"></i>
                                                </button>
                                            }
                                            <a asp-controller="Items" asp-action="Details" asp-route-id="@item.Id"
                                               class="btn btn-sm btn-outline-info"
                                               title="@item.Name detaylarını görüntüle" data-bs-toggle="tooltip">
                                                <i class="fas fa-eye" aria-hidden="true"></i>
                                            </a>
                                            <a asp-controller="Items" asp-action="Edit" asp-route-id="@item.Id"
                                               class="btn btn-sm btn-outline-warning" title="@item.Name bilgilerini düzenle"
                                               data-bs-toggle="tooltip">
                                                <i class="fas fa-edit" aria-hidden="true"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fa-solid fa-box-archive fa-3x text-muted mb-3" aria-hidden="true"></i>
                    <h3 class="h5 text-muted">Havuzda Ürün Bulunamadı</h3>
                    @if (!string.IsNullOrEmpty(searchValue) || !string.IsNullOrEmpty(companyIdValue) || !string.IsNullOrEmpty(categoryValue))
                    {
                        <p class="text-muted">Arama kriterlerinize uygun ürün bulunmuyor.</p>
                        <a href="@Url.Action("Index")" class="btn btn-outline-primary">
                            <i class="fas fa-times me-1" aria-hidden="true"></i> Filtreleri Temizle
                        </a>
                    }
                    else
                    {
                        <p class="text-muted">Henüz havuzda ürün bulunmuyor.</p>
                        <div class="d-flex gap-2 justify-content-center">
                            <a asp-controller="Computers" asp-action="Create" class="btn btn-primary">
                                <i class="fas fa-plus me-1" aria-hidden="true"></i> Bilgisayar Ekle
                            </a>
                            <a asp-controller="Items" asp-action="Create" class="btn btn-success">
                                <i class="fas fa-plus me-1" aria-hidden="true"></i> Ürün Ekle
                            </a>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Global variables for view management
        let currentViewType = 'table';

        // Select all functionality
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const itemCheckboxes = document.querySelectorAll('.item-checkbox');

            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });

            updateSelectedCount();
        }

        // Update selected count and button states
        function updateSelectedCount() {
            const selectedItems = document.querySelectorAll('.item-checkbox:checked');
            const assignButton = document.querySelector('button[onclick="assignSelectedItems()"]');

            if (selectedItems.length > 0) {
                assignButton.disabled = false;
                assignButton.innerHTML = `<i class="fas fa-user-plus me-1"></i> Seçilenleri Zimmetle (${selectedItems.length})`;
            } else {
                assignButton.disabled = true;
                assignButton.innerHTML = '<i class="fas fa-user-plus me-1"></i> Seçilenleri Zimmetle';
            }
        }

        // Assign selected items to employee
        function assignSelectedItems() {
            const selectedItems = document.querySelectorAll('.item-checkbox:checked');
            if (selectedItems.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Uyarı',
                    text: 'Lütfen en az bir ekipman seçin.',
                    confirmButtonText: 'Tamam'
                });
                return;
            }

            const selectedIds = Array.from(selectedItems).map(item => item.value);

            Swal.fire({
                title: 'Çoklu Zimmetleme',
                html: `Seçili <strong>${selectedIds.length}</strong> ekipman zimmetlenecek.<br>Devam etmek istiyor musunuz?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#198754',
                cancelButtonColor: '#6c757d',
                confirmButtonText: '<i class="fas fa-user-plus"></i> Evet, Zimmetle',
                cancelButtonText: '<i class="fas fa-times"></i> İptal',
                customClass: {
                    confirmButton: 'btn btn-success',
                    cancelButton: 'btn btn-secondary'
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    // Redirect to assignment page with selected IDs
                    const idsParam = selectedIds.join(',');
                    window.location.href = `/Pool/AssignMultiple?ids=${idsParam}`;
                }
            });
        }

        // Assign single item to employee
        function assignToEmployee(computerId, computerName) {
            Swal.fire({
                title: 'Zimmetleme',
                html: `<strong>${computerName}</strong> zimmetlenecek.<br>Devam etmek istiyor musunuz?`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#198754',
                cancelButtonColor: '#6c757d',
                confirmButtonText: '<i class="fas fa-user-plus"></i> Evet, Zimmetle',
                cancelButtonText: '<i class="fas fa-times"></i> İptal',
                customClass: {
                    confirmButton: 'btn btn-success',
                    cancelButton: 'btn btn-secondary'
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = `/Computer/Assign/${computerId}`;
                }
            });
        }

        // Delete pool item function
        function deletePoolItem(computerId, computerName) {
            Swal.fire({
                title: 'Ekipmanı Sil?',
                html: `<strong>${computerName}</strong> havuzdan silinecek.<br>Bu işlem geri alınamaz!`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: '<i class="fas fa-trash"></i> Evet, Sil',
                cancelButtonText: '<i class="fas fa-times"></i> İptal',
                customClass: {
                    confirmButton: 'btn btn-danger',
                    cancelButton: 'btn btn-secondary'
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    // Show loading
                    Swal.fire({
                        title: 'Siliniyor...',
                        html: 'Lütfen bekleyin...',
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    // Create form and submit
                    const form = document.createElement('form');
                    form.method = 'POST';
                    form.action = `/Computers/Delete/${computerId}`;

                    const token = document.querySelector('input[name="__RequestVerificationToken"]');
                    if (token) {
                        const tokenInput = document.createElement('input');
                        tokenInput.type = 'hidden';
                        tokenInput.name = '__RequestVerificationToken';
                        tokenInput.value = token.value;
                        form.appendChild(tokenInput);
                    }

                    document.body.appendChild(form);
                    form.submit();
                }
            });
        }

        // Toggle between table and cards view
        function toggleView(viewType) {
            const tableView = document.getElementById('tableView');
            const cardsView = document.getElementById('cardsView');
            const tableRadio = document.getElementById('tableViewRadio');
            const cardsRadio = document.getElementById('cardsViewRadio');

            if(!cardsView || !tableView) {
                return;
            }

            if (viewType === 'table') {
                tableView.style.display = 'block';
                cardsView.style.display = 'none';
                tableRadio.checked = true;
                cardsRadio.checked = false;
                currentViewType = 'table';
            } else {
                tableView.style.display = 'none';
                cardsView.style.display = 'block';
                tableRadio.checked = false;
                cardsRadio.checked = true;
                currentViewType = 'cards';
            }

            // Save preference to session storage
            try {
                sessionStorage.setItem('poolViewType', viewType);
            } catch (e) {
                // Silently handle storage errors
            }
        }

        // Export to Excel function
        function exportToExcel() {
            Swal.fire({
                title: 'Excel\'e Aktar',
                text: 'Havuz envanteri Excel dosyası olarak indirilecek.',
                icon: 'info',
                showCancelButton: true,
                confirmButtonText: '<i class="fas fa-download"></i> İndir',
                cancelButtonText: 'İptal',
                customClass: {
                    confirmButton: 'btn btn-primary',
                    cancelButton: 'btn btn-secondary'
                },
                buttonsStyling: false
            }).then((result) => {
                if (result.isConfirmed) {
                    // Show loading
                    Swal.fire({
                        title: 'Hazırlanıyor...',
                        html: 'Excel dosyası hazırlanıyor, lütfen bekleyin...',
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });

                    // Simulate file preparation time
                    setTimeout(() => {
                        window.location.href = '/Pool/ExportToExcel';
                        Swal.close();
                    }, 1000);
                }
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function () {
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl, {
                    delay: { show: 500, hide: 100 }
                });
            });

            // Load saved view type
            try {
                const savedViewType = sessionStorage.getItem('poolViewType') || 'table';
                toggleView(savedViewType);
            } catch (e) {
                toggleView('table');
            }

            // Initialize selection functionality
            const itemCheckboxes = document.querySelectorAll('.item-checkbox');
            itemCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateSelectedCount);
            });

            // Auto-submit search form on select change
            const categorySelect = document.getElementById('category');
            const companySelect = document.getElementById('companyId');
            const showOnlyAvailableCheckbox = document.getElementById('showOnlyAvailable');

            if (categorySelect) {
                categorySelect.addEventListener('change', function () {
                    document.getElementById('searchForm').submit();
                });
            }

            if (companySelect) {
                companySelect.addEventListener('change', function () {
                    document.getElementById('searchForm').submit();
                });
            }

            if (showOnlyAvailableCheckbox) {
                showOnlyAvailableCheckbox.addEventListener('change', function () {
                    document.getElementById('searchForm').submit();
                });
            }

            // Real-time search with debounce
            const searchInput = document.getElementById('search');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function () {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        document.getElementById('searchForm').submit();
                    }, 1000);
                });
            }

            // Prevent form submission on Enter key in search field to allow debounce to work
            searchInput?.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    document.getElementById('searchForm').submit();
                }
            });

            // Focus management for accessibility
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('search') || urlParams.has('category') || urlParams.has('companyId')) {
                const firstResult = document.querySelector('#tableView tbody tr:first-child a, #cardsView .card:first-child a');
                if (firstResult) {
                    setTimeout(() => firstResult.focus(), 100);
                }
            }

            // Handle keyboard navigation for accessibility
            document.addEventListener('keydown', function (e) {
                // Alt + T for table view
                if (e.altKey && e.key === 't') {
                    e.preventDefault();
                    toggleView('table');
                }
                // Alt + C for cards view
                if (e.altKey && e.key === 'c') {
                    e.preventDefault();
                    toggleView('cards');
                }
                // Alt + N for new equipment
                if (e.altKey && e.key === 'n') {
                    e.preventDefault();
                    const newEquipmentBtn = document.querySelector('a[asp-controller="Computer"][asp-action="Create"]');
                    if (newEquipmentBtn) {
                        newEquipmentBtn.click();
                    }
                }
                // Alt + A for assign selected
                if (e.altKey && e.key === 'a') {
                    e.preventDefault();
                    assignSelectedItems();
                }
            });

            // Update initial selected count
            updateSelectedCount();
        });

        // Handle responsive behavior
        function handleResponsiveChanges() {
            const isMobile = window.innerWidth < 768;

            if (isMobile && currentViewType === 'table') {
                // Auto-switch to cards view on mobile for better UX
                toggleView('cards');
            }
        }

        // Listen for window resize
        window.addEventListener('resize', debounce(handleResponsiveChanges, 250));

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Loading state management
        function showLoading(message = 'İşlem gerçekleştiriliyor...') {
            Swal.fire({
                title: message,
                allowOutsideClick: false,
                allowEscapeKey: false,
                showConfirmButton: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
        }

        function hideLoading() {
            Swal.close();
        }

        // Error handling
        window.addEventListener('error', function (e) {
            console.error('JavaScript error:', e.error);
            Swal.fire({
                icon: 'error',
                title: 'Bir hata oluştu',
                text: 'Sayfa yenilendiğinde sorun devam ederse sistem yöneticisine başvurun.',
                confirmButtonText: 'Tamam'
            });
        });
    </script>

    <style>
        /* Custom CSS for Pool Inventory */
        :root {
            --primary-color: #0d6efd;
            --success-color: #198754;
            --warning-color: #fd7e14;
            --danger-color: #dc3545;
            --info-color: #0dcaf0;
            --secondary-color: #6c757d;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --pool-color: #20c997;
            --border-radius: 0.375rem;
            --box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            --box-shadow-lg: 0 1rem 3rem rgba(0, 0, 0, 0.175);
            --transition: all 0.15s ease-in-out;
        }

        /* Pool-specific colors */
        .bg-success-light {
            background-color: rgba(25, 135, 84, 0.1);
            border-color: rgba(25, 135, 84, 0.2);
        }

        .table-success-light {
            background-color: rgba(25, 135, 84, 0.05);
        }

            .table-success-light:hover {
                background-color: rgba(25, 135, 84, 0.1) !important;
            }

        /* General improvements */
        .card {
            border: 1px solid rgba(0, 0, 0, 0.125);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

            .card:hover {
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            }

            /* Statistics cards */
            .card.bg-info,
            .card.bg-success,
            .card.bg-warning,
            .card.bg-danger {
                border: none;
                box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.2);
            }

        /* Equipment icons */
        .equipment-icon {
            width: 60px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .equipment-icon-lg {
            width: 60px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Pool item cards */
        .pool-item-card {
            transition: var(--transition);
            border: 1px solid #e9ecef;
            height: 100%;
            position: relative;
        }

            .pool-item-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
            }

            .pool-item-card.border-success {
                border-color: var(--success-color) !important;
                box-shadow: 0 0 0 0.1rem rgba(25, 135, 84, 0.1);
            }

            .pool-item-card .card-body {
                display: flex;
                flex-direction: column;
            }

        /* Button improvements */
        .btn {
            transition: var(--transition);
            border-radius: var(--border-radius);
        }

            .btn:hover:not(:disabled) {
                transform: translateY(-1px);
                box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.15);
            }

            .btn:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

        .btn-group .btn {
            border-radius: 0;
        }

            .btn-group .btn:first-child {
                border-top-left-radius: var(--border-radius);
                border-bottom-left-radius: var(--border-radius);
            }

            .btn-group .btn:last-child {
                border-top-right-radius: var(--border-radius);
                border-bottom-right-radius: var(--border-radius);
            }

        /* Table improvements */
        .table {
            margin-bottom: 0;
        }

            .table th {
                border-top: none;
                font-weight: 600;
                background-color: var(--light-color);
                position: sticky;
                top: 0;
                z-index: 10;
            }

        .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: rgba(0, 0, 0, 0.025);
        }

        .table-hover tbody tr:hover {
            background-color: rgba(var(--bs-primary-rgb), 0.075);
        }

        /* Checkbox improvements */
        .form-check-input:checked {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .form-check-input:focus {
            border-color: var(--success-color);
            box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
        }

        /* Badge improvements */
        .badge {
            font-size: 0.75em;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Search and filter section */
        .collapse {
            transition: var(--transition);
        }

        /* Form improvements */
        .form-control:focus,
        .form-select:focus {
            border-color: var(--pool-color);
            box-shadow: 0 0 0 0.2rem rgba(32, 201, 151, 0.25);
        }

        /* Pool-specific styling */
        .fas.fa-swimming-pool {
            color: var(--pool-color);
        }



        {
            flex-direction: column;
        }

        .btn-group {
            flex-direction: column;
        }

            .btn-group .btn {
                border-radius: var(--border-radius);
                margin-bottom: 0.25rem;
            }

        .statistics-cards .col-lg-3 {
            margin-bottom: 1rem;
        }

        }

        
    </style>