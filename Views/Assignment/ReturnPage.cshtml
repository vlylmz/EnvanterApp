@{
    ViewData["Title"] = "Zimmet İade";
    var companies = ViewBag.Companies as dynamic;
}

<div class="container-fluid mt-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div>
                    <h1 class="h2 mb-1 d-flex align-items-center">
                        <i class="fas fa-undo text-warning me-2" aria-hidden="true"></i>
                        Zimmet İade İşlemi
                    </h1>
                    <p class="text-muted mb-0">Zimmetli ürünleri iade alın</p>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                    <a asp-controller="Assignment" asp-action="Index" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-1" aria-hidden="true"></i> Geri Dön
                    </a>
                    <button type="button" class="btn btn-outline-primary" onclick="resetForm()">
                        <i class="fas fa-redo me-1" aria-hidden="true"></i> Formu Sıfırla
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Anti-forgery token for AJAX requests -->
    @Html.AntiForgeryToken()

    <!-- Search Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-search me-2"></i> Zimmetli Ürün Ara
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-lg-4 col-md-6">
                            <label for="searchType" class="form-label">Arama Türü</label>
                            <select class="form-select" id="searchType" onchange="onSearchTypeChange()">
                                <option value="all">Tüm Alanlar</option>
                                <option value="personnel">Personel Adı</option>
                                <option value="product">Ürün Adı</option>
                                <option value="barcode">Barkod</option>
                                <option value="company">Firma</option>
                            </select>
                        </div>
                        <div class="col-lg-6 col-md-6">
                            <label for="searchInput" class="form-label">Arama Metni</label>
                            <input type="text" class="form-control" id="searchInput" 
                                placeholder="Aramak istediğiniz metni girin..." 
                                onkeyup="handleSearchKeyup(event)">
                        </div>
                        <div class="col-lg-2 col-md-12">
                            <label class="form-label d-block">&nbsp;</label>
                            <button type="button" class="btn btn-primary w-100" onclick="searchAssignedProducts()">
                                <i class="fas fa-search me-2"></i> Ara
                            </button>
                        </div>
                    </div>

                    <!-- Quick Filters -->
                    <div class="mt-3">
                        <label class="form-label">Hızlı Filtreler:</label>
                        <div class="btn-group btn-group-sm" role="group" aria-label="Hızlı filtreler">
                            <button type="button" class="btn btn-outline-secondary" onclick="loadRecentAssignments()">
                                <i class="fas fa-clock me-1"></i> Son 7 Gün
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="loadCriticalItems()">
                                <i class="fas fa-exclamation-triangle me-1"></i> Kritik Ürünler
                            </button>
                            <button type="button" class="btn btn-outline-secondary" onclick="loadAllAssigned()">
                                <i class="fas fa-list me-1"></i> Tüm Zimmetler
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-clipboard-list me-2 text-warning"></i> Zimmetli Ürünler
                        </h5>
                        <div>
                            <span class="badge bg-warning text-dark" id="resultCount">0</span>
                            <span class="text-muted ms-2">sonuç bulundu</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="resultsContainer">
                        <div class="text-center py-5 text-muted">
                            <i class="fas fa-search fa-3x mb-3"></i>
                            <p>İade almak istediğiniz ürünleri aramak için yukarıdaki arama formunu kullanın.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Selected Items for Return -->
    <div class="row" id="returnSection" style="display: none;">
        <div class="col-lg-8">
            <div class="card shadow-sm mb-3">
                <div class="card-header bg-danger text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-undo me-2"></i> İade Edilecek Ürünler
                        </h5>
                        <div>
                            <span class="badge bg-white text-dark" id="selectedCount">0</span>
                            <span class="text-white ms-2">ürün seçildi</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div id="selectedItemsList">
                        <!-- Selected items will be listed here -->
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <!-- Return Reason -->
            <div class="card shadow-sm mb-3">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-comment-alt me-2 text-danger"></i> İade Sebebi
                    </h5>
                </div>
                <div class="card-body">
                    <div class="form-group mb-3">
                        <label for="returnReason" class="form-label">İade Nedeni</label>
                        <select class="form-select" id="returnReason">
                            <option value="Normal İade">Normal İade</option>
                            <option value="İş Değişikliği">İş Değişikliği</option>
                            <option value="İşten Ayrılma">İşten Ayrılma</option>
                            <option value="Cihaz Arızası">Cihaz Arızası</option>
                            <option value="Cihaz Değişimi">Cihaz Değişimi</option>
                            <option value="Departman Değişikliği">Departman Değişikliği</option>
                            <option value="Diğer">Diğer</option>
                        </select>
                    </div>
                    <div class="form-group mb-3">
                        <label for="returnNotes" class="form-label">Açıklama</label>
                        <textarea class="form-control" id="returnNotes" rows="4" 
                            placeholder="İade ile ilgili ek notlarınız..."></textarea>
                    </div>
                    <div class="d-grid gap-2">
                        <button type="button" class="btn btn-danger btn-lg" onclick="confirmReturn()" 
                            id="confirmReturnBtn" disabled>
                            <i class="fas fa-check-circle me-2"></i> İadeyi Onayla
                        </button>
                        <button type="button" class="btn btn-outline-secondary" onclick="clearSelection()">
                            <i class="fas fa-times me-2"></i> Seçimi Temizle
                        </button>
                    </div>
                </div>
            </div>

            <!-- Summary -->
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6 class="mb-3">İade Özeti</h6>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Seçilen Ürün:</span>
                        <strong id="summaryCount">0</strong>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Toplam Değer:</span>
                        <strong class="text-primary">₺<span id="summaryValue">0.00</span></strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Return Confirmation Modal -->
<div class="modal fade" id="confirmReturnModal" tabindex="-1" aria-labelledby="confirmReturnModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="confirmReturnModalLabel">
                    <i class="fas fa-undo me-2"></i> İade Onayı
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="confirmationDetails">
                    <!-- Confirmation details will be populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i> İptal
                </button>
                <button type="button" class="btn btn-danger" onclick="submitReturn()">
                    <i class="fas fa-check me-2"></i> İadeyi Tamamla
                </button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        // Global variables
        let assignedProducts = [];
        let selectedItems = [];
        let searchResults = [];

        // Search type change
        function onSearchTypeChange() {
            const searchType = document.getElementById('searchType').value;
            const searchInput = document.getElementById('searchInput');
            
            // Update placeholder based on search type
            switch(searchType) {
                case 'personnel':
                    searchInput.placeholder = 'Personel adı girin...';
                    break;
                case 'product':
                    searchInput.placeholder = 'Ürün adı girin...';
                    break;
                case 'barcode':
                    searchInput.placeholder = 'Barkod numarası girin...';
                    break;
                case 'company':
                    searchInput.placeholder = 'Firma adı girin...';
                    break;
                default:
                    searchInput.placeholder = 'Aramak istediğiniz metni girin...';
            }
            
            searchInput.focus();
        }

        // Handle search on Enter key
        function handleSearchKeyup(event) {
            if (event.key === 'Enter') {
                searchAssignedProducts();
            }
        }

        // Search assigned products
        async function searchAssignedProducts() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            
            if (!searchTerm && document.getElementById('searchType').value !== 'all') {
                Swal.fire('Uyarı', 'Lütfen arama kriteri girin.', 'warning');
                return;
            }
            
            await loadAssignedProducts(searchTerm);
        }

        // Load assigned products
        async function loadAssignedProducts(searchTerm = '') {
            try {
                const container = document.getElementById('resultsContainer');
                
                // Show loading
                container.innerHTML = `
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Yükleniyor...</span>
                        </div>
                        <p class="mt-3 text-muted">Zimmetli ürünler aranıyor...</p>
                    </div>
                `;
                
                const response = await fetch(`/Assignment/GetAssignedProducts?searchTerm=${encodeURIComponent(searchTerm)}`);
                const result = await response.json();
                
                console.log('API Response:', result); // Debug log
                
                if (result.success) {
                    searchResults = result.data;
                    document.getElementById('resultCount').textContent = result.count;
                    displayResults(searchResults);
                } else {
                    container.innerHTML = `
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            ${result.message}
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading assigned products:', error);
                document.getElementById('resultsContainer').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        Ürünler yüklenirken bir hata oluştu: ${error.message}
                    </div>
                `;
            }
        }

        // Display search results
        function displayResults(products) {
            const container = document.getElementById('resultsContainer');
            
            if (products.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5 text-muted">
                        <i class="fas fa-inbox fa-3x mb-3"></i>
                        <p>Arama kriterlerine uygun zimmetli ürün bulunamadı.</p>
                    </div>
                `;
                return;
            }
            
            let html = '<div class="result-list" style="max-height: 500px; overflow-y: auto;">';
            
            // Group by personnel
            const groupedByPersonnel = {};
            products.forEach(product => {
                const personnel = product.assignedPersonnel || 'Belirtilmemiş';
                if (!groupedByPersonnel[personnel]) {
                    groupedByPersonnel[personnel] = [];
                }
                groupedByPersonnel[personnel].push(product);
            });
            
            // Display grouped results
            Object.keys(groupedByPersonnel).sort().forEach(personnel => {
                const items = groupedByPersonnel[personnel];
                html += `
                    <div class="personnel-group mb-4">
                        <div class="personnel-header d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">
                                <i class="fas fa-user-circle text-primary me-2"></i>
                                ${personnel}
                            </h6>
                            <span class="badge bg-secondary">${items.length} ürün</span>
                        </div>
                        <div class="items-list">
                `;
                
                items.forEach(product => {
                    const isSelected = selectedItems.some(item => item.id === product.id);
                    const assignmentDate = product.assignmentDate ? 
                        new Date(product.assignmentDate).toLocaleDateString('tr-TR') : 'Belirtilmemiş';
                    
                    html += `
                        <div class="return-item ${isSelected ? 'selected' : ''}" data-product-id="${product.id}">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" 
                                    id="return-${product.id}" 
                                    ${isSelected ? 'checked' : ''}
                                    onchange="toggleItemSelection(${product.id})">
                                <label class="form-check-label w-100" for="return-${product.id}">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <div class="d-flex align-items-start">
                                                <div>
                                                    <h6 class="mb-1">${product.name}</h6>
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-barcode me-1"></i>${product.barcode}
                                                    </small>
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-tag me-1"></i>${product.category}
                                                    </small>
                                                    <small class="text-muted d-block">
                                                        <i class="fas fa-calendar me-1"></i>Zimmet Tarihi: ${assignmentDate}
                                                    </small>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end ms-3">
                                            <strong class="text-primary d-block">₺${(product.unitPrice || 0).toLocaleString('tr-TR', {minimumFractionDigits: 2})}</strong>
                                            <button type="button" class="btn btn-sm btn-outline-info mt-2" 
                                                onclick="viewItemDetails(${product.id})" title="Detaylar">
                                                <i class="fas fa-info-circle"></i>
                                            </button>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Toggle item selection
        function toggleItemSelection(productId) {
            const product = searchResults.find(p => p.id === productId);
            if (!product) return;
            
            const index = selectedItems.findIndex(item => item.id === productId);
            
            if (index > -1) {
                // Remove from selection
                selectedItems.splice(index, 1);
                document.querySelector(`.return-item[data-product-id="${productId}"]`).classList.remove('selected');
            } else {
                // Add to selection
                selectedItems.push(product);
                document.querySelector(`.return-item[data-product-id="${productId}"]`).classList.add('selected');
            }
            
            updateSelectedDisplay();
        }

        // Update selected items display
        function updateSelectedDisplay() {
            const count = selectedItems.length;
            document.getElementById('selectedCount').textContent = count;
            document.getElementById('summaryCount').textContent = count;
            
            if (count > 0) {
                document.getElementById('returnSection').style.display = 'flex';
                document.getElementById('confirmReturnBtn').disabled = false;
                
                // Calculate total value
                const totalValue = selectedItems.reduce((sum, item) => sum + (item.unitPrice || 0), 0);
                document.getElementById('summaryValue').textContent = 
                    totalValue.toLocaleString('tr-TR', {minimumFractionDigits: 2});
                
                // Update selected items list
                let html = '<div class="selected-items-list">';
                selectedItems.forEach(item => {
                    html += `
                        <div class="d-flex justify-content-between align-items-center py-2 border-bottom">
                            <div>
                                <strong>${item.name}</strong>
                                <br>
                                <small class="text-muted">
                                    ${item.barcode} | ${item.assignedPersonnel}
                                </small>
                            </div>
                            <div class="text-end">
                                <span class="text-primary">₺${(item.unitPrice || 0).toLocaleString('tr-TR', {minimumFractionDigits: 2})}</span>
                                <button type="button" class="btn btn-sm btn-outline-danger ms-2" 
                                    onclick="toggleItemSelection(${item.id})">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                document.getElementById('selectedItemsList').innerHTML = html;
            } else {
                document.getElementById('returnSection').style.display = 'none';
                document.getElementById('confirmReturnBtn').disabled = true;
            }
        }

        // Clear selection
        function clearSelection() {
            selectedItems = [];
            document.querySelectorAll('.return-item input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.querySelectorAll('.return-item.selected').forEach(item => {
                item.classList.remove('selected');
            });
            updateSelectedDisplay();
        }

        // View item details
        function viewItemDetails(productId) {
            const product = searchResults.find(p => p.id === productId);
            if (!product) return;
            
            const assignmentDate = product.assignmentDate ? 
                new Date(product.assignmentDate).toLocaleDateString('tr-TR') : 'Belirtilmemiş';
            
            Swal.fire({
                title: product.name,
                html: `
                    <div class="text-start">
                        <p><strong>Barkod:</strong> ${product.barcode}</p>
                        <p><strong>Kategori:</strong> ${product.category}</p>
                        <p><strong>Zimmetli Personel:</strong> ${product.assignedPersonnel}</p>
                        <p><strong>Zimmet Tarihi:</strong> ${assignmentDate}</p>
                        <p><strong>Birim Fiyat:</strong> ₺${(product.unitPrice || 0).toLocaleString('tr-TR', {minimumFractionDigits: 2})}</p>
                    </div>
                `,
                icon: 'info',
                confirmButtonText: 'Tamam'
            });
        }

        // Quick filter functions
        async function loadRecentAssignments() {
            // Clear search input
            document.getElementById('searchInput').value = '';
            document.getElementById('searchType').value = 'all';
            // This would need backend support to filter by date
            // For now, just load all and you can add date filtering later
            await loadAssignedProducts('');
        }

        async function loadCriticalItems() {
            // Clear search input
            document.getElementById('searchInput').value = '';
            document.getElementById('searchType').value = 'all';
            // This would need backend support to filter critical items
            await loadAssignedProducts('');
        }

        async function loadAllAssigned() {
            // Clear search input
            document.getElementById('searchInput').value = '';
            document.getElementById('searchType').value = 'all';
            await loadAssignedProducts('');
        }

        // Confirm return
        function confirmReturn() {
            if (selectedItems.length === 0) {
                Swal.fire('Uyarı', 'Lütfen iade edilecek ürünleri seçin.', 'warning');
                return;
            }
            
            const returnReason = document.getElementById('returnReason').value;
            const returnNotes = document.getElementById('returnNotes').value;
            const totalValue = selectedItems.reduce((sum, item) => sum + (item.unitPrice || 0), 0);
            
            // Group items by personnel
            const itemsByPersonnel = {};
            selectedItems.forEach(item => {
                const personnel = item.assignedPersonnel || 'Belirtilmemiş';
                if (!itemsByPersonnel[personnel]) {
                    itemsByPersonnel[personnel] = [];
                }
                itemsByPersonnel[personnel].push(item);
            });
            
            let detailsHtml = `
                <div class="return-confirmation">
                    <div class="mb-3">
                        <h6>İade Sebebi:</h6>
                        <p>${returnReason}</p>
                        ${returnNotes ? `<p class="text-muted">${returnNotes}</p>` : ''}
                    </div>
                    
                    <h6>İade Edilecek Ürünler (${selectedItems.length} adet):</h6>
            `;
            
            // Display items grouped by personnel
            Object.keys(itemsByPersonnel).forEach(personnel => {
                const items = itemsByPersonnel[personnel];
                detailsHtml += `
                    <div class="mb-3">
                        <p class="mb-2"><strong>${personnel}</strong> (${items.length} ürün)</p>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Ürün Adı</th>
                                        <th>Barkod</th>
                                        <th>Kategori</th>
                                        <th class="text-end">Fiyat</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                items.forEach(item => {
                    detailsHtml += `
                        <tr>
                            <td>${item.name}</td>
                            <td><code>${item.barcode}</code></td>
                            <td>${item.category}</td>
                            <td class="text-end">₺${(item.unitPrice || 0).toLocaleString('tr-TR', {minimumFractionDigits: 2})}</td>
                        </tr>
                    `;
                });
                
                detailsHtml += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            detailsHtml += `
                    <div class="border-top pt-3">
                        <div class="d-flex justify-content-between">
                            <strong>Toplam Değer:</strong>
                            <strong class="text-primary">₺${totalValue.toLocaleString('tr-TR', {minimumFractionDigits: 2})}</strong>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('confirmationDetails').innerHTML = detailsHtml;
            
            // Show confirmation modal
            const modal = new bootstrap.Modal(document.getElementById('confirmReturnModal'));
            modal.show();
        }

        // Submit return
        async function submitReturn() {
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('confirmReturnModal')).hide();
            
            // Show loading
            Swal.fire({
                title: 'İşlem yapılıyor...',
                html: 'İade işlemi gerçekleştiriliyor, lütfen bekleyin...',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading();
                }
            });
            
            const returnReason = document.getElementById('returnReason').value;
            const returnNotes = document.getElementById('returnNotes').value;
            
            // Process returns one by one (or you could create a bulk return endpoint)
            let successCount = 0;
            let errors = [];
            
            for (const item of selectedItems) {
                try {
                    const form = new FormData();
                    form.append('productId', item.id);
                    form.append('returnReason', returnReason);
                    form.append('notes', returnNotes);
                    
                    const token = document.querySelector('input[name="__RequestVerificationToken"]');
                    if (token) {
                        form.append('__RequestVerificationToken', token.value);
                    }
                    
                    const response = await fetch('/Assignment/ReturnProduct', {
                        method: 'POST',
                        body: form
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        successCount++;
                    } else {
                        errors.push(`${item.name}: ${result.message}`);
                    }
                } catch (error) {
                    errors.push(`${item.name}: İade işlemi başarısız`);
                }
            }
            
            // Show results
            if (successCount === selectedItems.length) {
                Swal.fire({
                    icon: 'success',
                    title: 'Başarılı!',
                    text: `${successCount} adet ürün başarıyla iade alındı.`,
                    confirmButtonText: 'Tamam'
                }).then(() => {
                    resetForm();
                });
            } else if (successCount > 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'Kısmen Başarılı',
                    html: `${successCount} ürün iade alındı.<br><br>Hatalar:<br>${errors.join('<br>')}`,
                    confirmButtonText: 'Tamam'
                }).then(() => {
                    resetForm();
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Hata!',
                    html: `İade işlemi başarısız.<br><br>${errors.join('<br>')}`,
                    confirmButtonText: 'Tamam'
                });
            }
        }

        // Reset form
        function resetForm() {
            selectedItems = [];
            searchResults = [];
            
            document.getElementById('searchType').value = 'all';
            document.getElementById('searchInput').value = '';
            document.getElementById('returnReason').value = 'Normal İade';
            document.getElementById('returnNotes').value = '';
            
            document.getElementById('resultsContainer').innerHTML = `
                <div class="text-center py-5 text-muted">
                    <i class="fas fa-search fa-3x mb-3"></i>
                    <p>İade almak istediğiniz ürünleri aramak için yukarıdaki arama formunu kullanın.</p>
                </div>
            `;
            
            document.getElementById('resultCount').textContent = '0';
            updateSelectedDisplay();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on search input
            document.getElementById('searchInput').focus();
            
            // Automatically load all assigned products on page load
            loadAllAssigned();
        });
    </script>

    <style>
        /* Return item styling */
        .return-item {
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            transition: all 0.3s ease;
            background: white;
        }

        .return-item:hover {
            border-color: #fd7e14;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .return-item.selected {
            background: #fff3cd;
            border-color: #fd7e14;
        }

        /* Personnel group styling */
        .personnel-group {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        .personnel-header {
            border-bottom: 2px solid #dee2e6;
            padding-bottom: 10px;
        }

        /* Form check styling */
        .form-check-input {
            width: 20px;
            height: 20px;
            margin-top: 0;
            cursor: pointer;
        }

        .form-check-label {
            cursor: pointer;
            padding-left: 10px;
        }

        /* Result list scrollbar */
        .result-list::-webkit-scrollbar {
            width: 8px;
        }

        .result-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .result-list::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .result-list::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Card hover effects */
        .card {
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* Button group styling */
        .btn-group .btn {
            position: relative;
            transition: all 0.3s ease;
        }

        .btn-group .btn:hover:not(:disabled) {
            z-index: 2;
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Selected items list */
        .selected-items-list {
            max-height: 300px;
            overflow-y: auto;
        }

        /* Return confirmation styling */
        .return-confirmation .table {
            font-size: 14px;
        }

        .return-confirmation .table td,
        .return-confirmation .table th {
            padding: 0.5rem;
        }

        /* Responsive adjustments */
        @@media (max-width: 768px) {
            .return-item {
                padding: 10px;
            }
            
            .return-item h6 {
                font-size: 14px;
            }
            
            .return-item small {
                font-size: 12px;
            }
        }
    </style>
}