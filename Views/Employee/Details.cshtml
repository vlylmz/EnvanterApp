@model WebApplication1.Models.Employee
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    ViewData["Title"] = "Çalışan Detayı";
}

<div class="container mt-4">
    <!-- Header Section -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index">Çalışanlar</a></li>
            <li class="breadcrumb-item active">@Model.FirstName @Model.LastName</li>
        </ol>
    </nav>
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-body bg-gradient-primary text-white">
                    <div class="row align-items-center">
                        <div class="col-md-2 text-center">
                            <div class="avatar-circle">
                                <i class="fas fa-user fa-3x"></i>
                            </div>
        <div>
            <a asp-action="Edit" asp-route-id="@Model.Employee.Id" class="btn btn-warning btn-sm">
                <i class="fas fa-edit"></i> Düzenle
            </a>
            <a asp-action="Index" class="btn btn-secondary btn-sm">
                <i class="fas fa-arrow-left"></i> Geri Dön
            </a>
                        </div>
                        <div class="col-md-8">
                            <h2 class="mb-1">@Model.FirstName @Model.LastName</h2>
                            <p class="mb-0 opacity-75">
                                <i class="fas fa-building me-2"></i>@(Model.Company?.Name ?? "Firma Atanmamış")
                            </p>
                            <small class="opacity-75">
                                <i class="fas fa-calendar me-1"></i>
                                Kayıt Tarihi: @Model.CreatedDate.ToString("dd MMMM yyyy", new System.Globalization.CultureInfo("tr-TR"))
                            </small>
                        </div>

    <!-- Employee Info Card -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="fas fa-id-card"></i> Kişisel Bilgiler</h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4"><i class="fas fa-user text-muted"></i> Ad</dt>
                        <dd class="col-sm-8 fw-bold">@Model.Employee.FirstName</dd>

                        <dt class="col-sm-4"><i class="fas fa-user text-muted"></i> Soyad</dt>
                        <dd class="col-sm-8 fw-bold">@Model.Employee.LastName</dd>

                        <dt class="col-sm-4"><i class="fas fa-envelope text-muted"></i> Email</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.Employee.Email))
                            {
                                <a href="mailto:@Model.Employee.Email">@Model.Employee.Email</a>
                            }
                            else
                            {
                                <span class="text-muted">Belirtilmemiş</span>
                            }
                        </dd>

                        <dt class="col-sm-4"><i class="fas fa-phone text-muted"></i> Telefon</dt>
                        <dd class="col-sm-8">
                            @if (!string.IsNullOrEmpty(Model.Employee.Phone))
                                    {
                                <a href="tel:@Model.Employee.Phone">@Model.Employee.Phone</a>
                                    }
                                    else
                                    {
                                        <span class="text-muted">Belirtilmemiş</span>
                                    }
                        </dd>
                    </dl>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4"><i class="fas fa-building text-muted"></i> Firma</dt>
                        <dd class="col-sm-8">
                            @if (Model.Employee.Company != null)
                                    {
                                <span class="badge bg-info">@Model.Employee.Company.Name</span>
                                    }
                                    else
                                    {
                                <span class="badge bg-secondary">ID: @Model.Employee.CompanyId</span>
                                    }
                        </dd>

                        <dt class="col-sm-4"><i class="fas fa-toggle-on text-muted"></i> Durum</dt>
                        <dd class="col-sm-8">
                            @if (Model.Employee.IsActive)
                                    {
                                <span class="badge bg-success"><i class="fas fa-check"></i> Aktif</span>
                                    }
                                    else
                                    {
                                <span class="badge bg-danger"><i class="fas fa-times"></i> Pasif</span>
                                    }
                        </dd>

                        <dt class="col-sm-4"><i class="fas fa-calendar text-muted"></i> Oluşturulma</dt>
                        <dd class="col-sm-8">
                            <span class="text-muted">@Model.Employee.CreatedDate.ToString("dd.MM.yyyy HH:mm")</span>
                        </dd>
                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

    <!-- Assets Section -->
    <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0"><i class="fas fa-box"></i> Zimmetli Varlıklar</h5>
                </div>
        <div class="card-body p-0">
            <div class="accordion" id="employeeAssetsAccordion">
                <!-- Bilgisayarlar -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingComputers">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseComputers" aria-expanded="false" aria-controls="collapseComputers">
                            <i class="fas fa-laptop me-2 text-primary"></i>
                            <strong>Bilgisayarlar</strong>
                            <span class="badge bg-primary rounded-pill ms-2">@(Model.Computers?.Count ?? 0)</span>
                        </button>
                    </h2>
                    <div id="collapseComputers" class="accordion-collapse collapse" aria-labelledby="headingComputers" data-bs-parent="#employeeAssetsAccordion">
                        <div class="accordion-body">
                            @if (Model.Computers != null && Model.Computers.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th><i class="fas fa-desktop"></i> Bilgisayar Adı</th>
                                                <th><i class="fas fa-barcode"></i> Seri No</th>
                                                <th><i class="fas fa-info-circle"></i> Durum</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var pc in Model.Computers)
                                            {
                                                <tr>
                                                    <td><strong>@pc.Name</strong></td>
                                                    <td><code>@pc.SerialNumber</code></td>
                                                    <td>
                                                        <span class="badge bg-info">@pc.Status</span>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
            </div>
                            }
                            else
            {
                                <div class="text-center py-4 text-muted">
                                    <i class="fas fa-laptop fa-2x mb-2"></i>
                                    <p><em>Bu çalışana zimmetli bilgisayar bulunmuyor.</em></p>
                    </div>
                            }
                            </div>
                            <div>
                                <h6 class="mb-1">@Model.Company.Name</h6>
                                <small class="text-muted">Bağlı Firma</small>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>

                <!-- Yazılımlar -->
                <div class="accordion-item">
                    <h2 class="accordion-header" id="headingSoftwares">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSoftwares" aria-expanded="false" aria-controls="collapseSoftwares">
                            <i class="fas fa-compact-disc me-2 text-success"></i>
                            <strong>Yazılımlar</strong>
                            <span class="badge bg-success rounded-pill ms-2">@(Model.Softwares?.Count ?? 0)</span>
                        </button>
                    </h2>
                    <div id="collapseSoftwares" class="accordion-collapse collapse" aria-labelledby="headingSoftwares" data-bs-parent="#employeeAssetsAccordion">
                        <div class="accordion-body">
                            @if (Model.Softwares != null && Model.Softwares.Any())
                        {
                                <div class="table-responsive">
                                    <table class="table table-sm table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th><i class="fas fa-code"></i> Yazılım Adı</th>
                                                <th><i class="fas fa-tag"></i> Marka</th>
                                                <th><i class="fas fa-calendar"></i> Satın Alma</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var sw in Model.Softwares)
                                            {
                                                <tr>
                                                    <td><strong>@sw.Name</strong></td>
                                                    <td><span class="badge bg-secondary">@sw.Brand</span></td>
                                                    <td>
                                                        @if (sw.PurchaseDate.HasValue)
                                                        {
                                                            <small class="text-muted">@sw.PurchaseDate.Value.ToString("dd.MM.yyyy")</small>
                        }
                                                        else
                        {
                                                            <small class="text-muted">-</small>
                                                        }
                                                    </td>
                                                </tr>
                        }

                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            <i class="fas fa-trash me-2"></i>Sil
                        </button>
                    </div>
                </div>
            </div>

            <!-- Statistics Card -->
            
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="stat-item">
                                <h4 class="text-primary mb-0">@((DateTime.Now - Model.CreatedDate).Days)</h4>
                                <small class="text-muted">Gün Önce Eklendi</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="stat-item">
                                <h4 class="text-success mb-0">
                                    @(Model.IsActive ? "✓" : "✗")
                                </h4>
                                <small class="text-muted">Durum</small>
                            </div>
                            }
                            else
                            {
                                <div class="text-center py-4 text-muted">
                                    <i class="fas fa-compact-disc fa-2x mb-2"></i>
                                    <p><em>Bu çalışana zimmetli yazılım bulunmuyor.</em></p>
                        </div>
                            }
                    </div>
                </div>
            </div>

        <!-- Time Log Panel Sliderlı -->
        <div class="card shadow-sm border-0" style="max-width: 980px; margin-top: 20px; margin-right: auto; margin-bottom: 20px; margin-left: 0;"
             ">
            <div class="card-header bg-white border-bottom">
                <h5 class="mb-0">
                    <i class="fas fa-history text-primary me-2"></i>
                    Zaman Çizelgesi
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="timeline-logs px-3 py-2">
                    <div class="log-entry border-bottom pb-2 mb-2">
                        <div class="fw-bold">Hesap oluşturuldu</div>
                        <div class="text-muted small">08.05.2024 09:10</div>
                    </div>
                    <div class="log-entry border-bottom pb-2 mb-2">
                        <div class="fw-bold">Şifre güncellendi</div>
                        <div class="text-muted small">10.05.2024 13:31</div>
                    </div>
                    <div class="log-entry border-bottom pb-2 mb-2">
                        <div class="fw-bold">Email adresi eklendi</div>
                        <div class="text-muted small">13.05.2024 21:08</div>
                    </div>
                    <div class="log-entry border-bottom pb-2 mb-2">
                        <div class="fw-bold">Hesap aktif edildi</div>
                        <div class="text-muted small">15.05.2024 07:17</div>
                    </div>
                    <div class="log-entry border-bottom pb-2 mb-2">
                        <div class="fw-bold">Telefon numarası değiştirildi</div>
                        <div class="text-muted small">25.05.2024 16:42</div>
                    </div>
                    <div class="log-entry border-bottom pb-2 mb-2">
                        <div class="fw-bold">Hesap pasif edildi</div>
                        <div class="text-muted small">31.05.2024 18:59</div>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .timeline-logs {
                max-height: 208px; /* 5-6 log için ideal yükseklik */
                overflow-y: auto;
                background: #f7fafc;
                border-radius: 0 0 12px 12px;
            }

                .timeline-logs::-webkit-scrollbar {
                    width: 10px;
                    background: #e2e8f0;
                    border-radius: 10px;
                }

                .timeline-logs::-webkit-scrollbar-thumb {
                    background: linear-gradient(160deg, #007bff 30%, #54a0ff 100%);
                    border-radius: 10px;
                }

                    .timeline-logs::-webkit-scrollbar-thumb:hover {
                        background: linear-gradient(180deg, #0056b3, #007bff);
                    }

            .log-entry:last-child {
                border-bottom: none;
                margin-bottom: 0;
                padding-bottom: 0;
            }

            .log-entry {
                transition: background 0.2s;
            }

                .log-entry:hover {
                    background: #e3ebf6;
                }
        </style>

        </div>
    </div>
    </div>

    <!-- Quick Actions -->
    <div class="mt-4 text-center">
        <div class="btn-group" role="group">
            <a asp-action="Edit" asp-route-id="@Model.Employee.Id" class="btn btn-warning">
                <i class="fas fa-edit"></i> Düzenle
                </a>
            <a asp-action="Index" class="btn btn-secondary">
                <i class="fas fa-list"></i> Tüm Çalışanlar
                    </a>
            <button type="button" class="btn btn-info" onclick="window.print()">
                <i class="fas fa-print"></i> Yazdır
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Smooth accordion animations
        document.addEventListener('DOMContentLoaded', function() {
            // Auto expand first accordion if there are items
            @if ((Model.Computers?.Count ?? 0) > 0)
            {
                    <text>
                    $('#collapseComputers').addClass('show');
                    $('#headingComputers .accordion-button').removeClass('collapsed').attr('aria-expanded', 'true');
                    </text>
            }
            else if ((Model.Softwares?.Count ?? 0) > 0)
            {
                    <text>
                    $('#collapseSoftwares').addClass('show');
                    $('#headingSoftwares .accordion-button').removeClass('collapsed').attr('aria-expanded', 'true');
                    </text>
            }
            else if ((Model.Supplies?.Count ?? 0) > 0)
            {
                    <text>
                    $('#collapseSupplies').addClass('show');
                    $('#headingSupplies .accordion-button').removeClass('collapsed').attr('aria-expanded', 'true');
                    </text>
    }
        });
    </script>
    }

<style>
    .accordion-button:not(.collapsed) {
        background-color: #f8f9fa;
        border-color: #dee2e6;
    }

    .table th {
        border-top: none;
        font-weight: 600;
        font-size: 0.875rem;
        font-weight: 600;
        color: #6c757d;
        margin-bottom: 8px;
        display: block;
    }

    .accordion-button:focus {
        box-shadow: none;
        border-color: #dee2e6;
    }

    .timeline {
        position: relative;
        padding-left: 30px;
    }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e9ecef;
        }

    {
        display: none !important;
    }

    .accordion-collapse {
        display: block !important;
    }

    .accordion-button {
        display: none !important;
    }

    .stat-item {
        padding: 10px;
    }
</style>